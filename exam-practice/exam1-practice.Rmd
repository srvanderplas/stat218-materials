---
output: 
  pdf_document: 
    df_print: kable
    latex_engine: xelatex
    template: exam-template.tex
course: "Stat 218"
exam: "Exam 1 Practice Test"
geometry: margin=1in
params:
  version: 1
  key: false
---
---
version_str: `r params$version`
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, dpi = 300)
library(tidyverse)
theme_set(theme_bw())
```

```{r fix-latex, results='asis'}
if (params$key) {
  cat("\\newcommand{\\answer}[1]{{\\color{red}\\emph{#1}}}")
  cat("\\providecommand{\\tightlist}{\\setlength{\\itemsep}{1em}\\setlength{\\parskip}{0pt}}")
  cat("\\lhead{Name: \\color{red}{KEY}}")
  cat("\\fancypagestyle{firststyle}")
  cat("{\\lhead{Name:\\color{red}{KEY}}}")
} else {
  cat("\\newcommand{\\answer}[1]{\\relax}")
  cat("\\providecommand{\\tightlist}{\\setlength{\\itemsep}{3em}\\setlength{\\parskip}{0pt}}")
}

```

```{r define-variables, include = F, cache = F}

true_false_qs <- tribble(~statement, ~answer,
                         "A parameter is the quantity of interest computed for the sample", F,
                         "A statistic is the quantity of interest computed for the sample", F,
                         "A p-value is the proportion of failures in the sample", F,
                         "The central limit theorem predicts the behavior of the null distribution when validity conditions are not met", F,
                         "A sampling frame is the set of all possible observational units in the population", T,
                         "$\\pi$ is the symbol for the population proportion", T,
                         "$\\hat p$ is the symbol for the sample mean", F, 
                         "A standardized statistic is the distance between the sample statistic and the population mean", F, 
                         "A *plausible* model is one in which there is no reasonable explanation for the data we observed", F, 
                         "The validity conditions for a hypothesis test of a proportion are to have 20 observations and a symmetric distribution", F,
                         "A categorical variable has at least three possible options", F,
                         "Binary variables are categorical variables", T, 
                         "Normal distributions have a right skewed distribution", F,
                         "A two-sided test estimates the p-value by considering results that are not as extreme as the observed result in either direction", F,
                         "The standardized statistic is commonly denoted by the variable $t$ or $z$", T,
                         "$\\alpha$ is the probability of a Type I error", T
)
```

# Formula sheet

\vfill
Sample standard deviation: $\displaystyle \sqrt{\frac{\sum(x-\overline{x})^2}{n-1}}$
\vfill
Sample proportion: $\displaystyle \hat p = \frac{\text{Number of successes in the sample}}{n}$

\vfill
Standardized statistic: $\displaystyle \frac{\text{statistic} - \text{mean of null distribution}}{\text{SD of null distribution}}$

\vfill
Long-run proportion standard deviation: $\displaystyle\sqrt\frac{\pi(1-\pi)}{n}$

\vfill
Standardized statistic for a single mean: $t = \displaystyle\frac{\overline x - \mu_0}{s/\sqrt{n}}$

\vfill
\clearpage
# Concepts
Circle T (true) or F (false) for each of the following statements:\vspace{1em}

\begin{description}[align=right,labelindent=4em,leftmargin=!]
```{r results='asis'}
set.seed(2310947)
ordered_sample <- sample_n(true_false_qs, size = nrow(true_false_qs), replace = F) %>%
  mutate(ans = ifelse(answer, "T\\hspace{1em}\\phantom{F}", "\\phantom{T}\\hspace{1em}F"))
if (!params$key) {
  cat(paste(sprintf("\\item[T\\hspace{1em}F\\hspace{1em}] %s\\vfill", ordered_sample$statement), 
  collapse = "

")) } else {
  cat(paste(sprintf("\\item[{\\color{red} %s\\hspace{1em}}] %s\\vfill", ordered_sample$ans, ordered_sample$statement), 
  collapse = "

"))
}

```
\end{description}

\clearpage

# Weather Predictions

Weather forecasts contain many different variables - high temperature, low temperature, wind speed, and precipitation. The National Weather Service would like to evaluate whether their precipitation predictions are significantly better than the expected success rate of 75%. The NWS defines a success as predicting that precipitation will occur on a day when precipitation actually falls, or predicting that precipitation will not occur on a day when there is no precipitation. That is, we are not considering here the *amount* of precipitation; only whether or not it occurred.  

Evaluating predictions made over 2019 in Lincoln, the weather service correctly predicted the presence or absence of precipitation on 290 of the 365 days of the year. 

1. What is the research question?      
\longanswer\answer{Is the NWS's model for precipitation better than expected?}
2. What is the observational unit?     
\longanswer\answer{A single day of the year.}
3. What is the parameter?     
\longanswer\answer{The long-run proportion of days with correctly predicted precipitation.}
4. Calculate the sample statistic      
\longanswer[4em]\answer{$$\hat p = \frac{290}{365} \approx `r sprintf("%0.3f", 290/365)`$$}
5. What is $H_0$?     
\longanswer\answer{$\pi=0.75$}
6. What is $H_A$?     
\longanswer\answer{$\pi>0.75$}
7. What type of hypothesis test is this? 
\longanswer\answer{A one-sided hypothesis test}
8. You want to conduct a simulation to answer the research question. To test the hypotheses above, you set the one-proportion applet to have the following values: \vspace{1em}
    a. Probability of heads: \underline{\hspace{1in}\answer{0.75}\hspace{1in}}    
    b. Number of tosses: \underline{\hspace{1in}\answer{365}\hspace{1in}}\vspace{-1em}
    c. Number of repetitions: 100
9. In this simulation, what does a heads represent?     
\longanswer\answer{Heads represents a day with correctly predicted precipitation. }
10. Your simulation produces the data shown in the plot below:    
```{r weather-data, fig.width = 8, fig.height = 2.8}
set.seed(20200213)
day_sim <- rbinom(100, 365, prob = .75)
day_success <- mean(day_sim/365)
max_day_success <- max(day_sim/365)

p <- qplot(x = day_sim/365, geom = "dotplot", method = "histodot", 
      binwidth = 1/365, 
      stackratio = 1.005, fill = I("white")) +
  scale_x_continuous(sprintf("Proportion of days correctly predicted"), 
                     breaks = c((0:72)*5/365, 1), 
                     labels = c("0", sprintf("%d/%d", (1:72)*5,
                                             365), "1"),
                     expand = expand_scale(mult = 0, add = 2/365)) +
  theme(axis.text.y = element_blank(), 
        axis.title.y = element_blank(), 
        axis.ticks.y = element_blank()) +
  ggtitle(bquote(paste("Simulation Results, ", pi == .(.75))))

if (params$key) {
  p <- p + annotate("segment", x = (290 - .5)/365, xend = (290 - .5)/365, y = 0, yend = Inf, color = "red") +
    annotate("segment", x = (290 - .5)/365, xend = pmin(max_day_success, 1), y = .75, yend = .75, arrow = arrow(ends = "last", length = unit(.25, "cm")), color = "red") + 
    geom_dotplot(aes(x = day_sim[day_sim >= 290]/365), fill = "red", method = "histodot", binwidth = 1/365, stackratio = 1.005)
} 
p

day_prop <- mean(day_sim >= 290)
day_stat <- (290/365 - .75)/sqrt(.75*(1-.75)/365)

```    
    a. What does a dot represent in the plot?     
    \longanswer\answer{A set of 365 simulated observations.}
    b. On the plot, draw one or two vertical line(s) to indicate the cutoff(s), and an arrow(s) indicating the direction(s) of $H_A$. Shade in the dots corresponding to the simulation p-value calculation. 
    c. Calculate the simulation p-value:     
    \longanswer[4em]\answer{$$P(\hat p >= 290/365)\approx P(p^\ast >= .795) = \frac{`r sum(day_sim >= 290)`}{`r length(day_sim)`} = `r day_prop`$$}
    e. What is your conclusion?     
    \longanswer[6em]{\answer{With a p-value of 0.06, I have moderate evidence against the null hypothesis that $\pi = 0.75$. I reject $H_0$ and conclude that the national weather service correctly predicts whether or not there will be precipitation over the long run with a probability of $\pi > .75$} }
    f. Is it appropriate to use theory-based inference on this data? Why or why not?     
    \longanswer[6em]{\answer{Yes, we could use theory-based inference on this data. We would expect that we would have 365\*0.75 = 273.75 successes and 365\*0.25 = 91.25 failures. As both the expected successes and failures under $H_0$ are greater than 10, we can use theory-based inference.}}
    g. Calculate the theory-based standardized statistic for this test.     
    \longanswer[6em]\answer{$$z = \frac{\hat p - \pi}{\sqrt{\pi(1-\pi)/n}} = \frac{.7945 - .75}{\sqrt{.75(1-.75)/365}} = \frac{`r 290/365 - .75`}{`r sqrt(.75*(1-.75)/365)`} = `r round(day_stat, 2)`$$}
    c. What should the national weather service conclude about their precipitation model?     
    \longanswer[6em]\answer{The national weather service should conclude that there is moderate evidence against the null hypothesis. The standardized statistic is almost 2, which indicates that the sample value is unlikely to be observed by chance alone. The NWS should reject $H_0$ and conclude that $\pi > 0.75$}
\clearpage
```{r ufo-data, include = F}
set.seed(302847923)

alien <- tibble(n = rpois(52, 16))
alien_mean <- round(mean(alien$n), 2)
alien_sd <- round(sd(alien$n), 2)
```

# UFO Sightings

Roswell, NM is home to a number of stories about sightings of unidentified flying objects (UFOs). The local police department has historically recorded an average of 10 reported sightings per month. Over the past year, a TV show about aliens has been popular on Netflix. During the period when the show was available, there have been, on average, `r sprintf("%.0.2f", mean(alien$n))` reported sightings per week (sample SD = `r sprintf("%0.2f", sd(alien$n))`). The police officers would like to know if there has been an increase in the number of reported UFO sightings since the TV show became available on Netflix. 

```{r alien-hist, message = F, warning = F, error = F, fig.width = 8, fig.height = 3}
ggplot(alien, aes(x = n)) + geom_dotplot(color = "black", fill = "white", binwidth = 1, dotsize = .5) + 
  scale_y_continuous("Count") + 
  scale_x_continuous("Number of Reported UFO Sightings") + 
  annotate("segment", x = alien_mean, xend = alien_mean, y = 0, yend = Inf, color = "red") + 
  annotate("text", x = alien_mean, y = 10, label = "bar(x)", parse = T, hjust = 1.5, color = "red") + 
  annotate("text", x = Inf, y = 10,  label = sprintf("atop(bar(x) == %.1f, s == %.1f)", alien_mean, alien_sd), parse = T, vjust = 1, hjust = 1.1) + 
  ggtitle("Number of weekly UFO sightings reported to the police")
```

1. Describe the shape of the distribution of the number of UFO sightings. Will the median be less than, greater than, or approximately equal to the sample mean?     
\longanswer\answer{The distribution is relatively symmetric, with a mean around 16 and a standard deviation of almost 4. }
2. Formulate an appropriate research question      
\longanswer\answer{Are there more reported UFO sightings since the show became popular on Netflix?}
3. What is the parameter, in words?     
\longanswer\answer{The long-run average number of reported UFO sightings since the show became popular on Netflix?}
4. Using appropriate mathematical notation, write out $H_0$ and $H_A$.     
\longanswer[3em]\answer{$H_0: \mu = 10$\\$H_A: \mu > 10$}
5. What are the values of the following variables? If the value is not known, write "unknown". You can use values under $H_0$ where applicable.    
\begin{align*}
\mu &= \answer{10} & \sigma &= \answer{\text{unknown}}\\
\\
\overline x & = \answer{`r sprintf("%.02f", mean(alien$n))`} &  s &= \answer{`r sprintf("%.02f", sd(alien$n))`}
\end{align*}
6. Calculate the standardized statistic.     
\longanswer[5em]\answer{$$t = \frac{\overline x - \mu}{s/\sqrt{n}} = \frac{`r alien_mean` - 10}{`r alien_sd`/\sqrt{`r nrow(alien)`}} = \frac{`r sprintf("%.2f", alien_mean - 10)`}{`r sprintf("%.2f", alien_sd/sqrt(nrow(alien)))`} = `r sprintf("%.2f", (alien_mean - 10)/(alien_sd/sqrt(nrow(alien))))`$$}
8. What are the validity conditions for a one-sample t-test?          
\longanswer[6em]\answer{The variable should have a symmetric distribution, or there should be at least 20 observations and the sample distribution should not be strongly skewed.}
9. Do you think the validity conditions are met? Why or why not?        
\longanswer[7em]\answer{There are more than 20 observations, and the sampling distribution is not strongly skewed.}
10. (Assume the validity conditions are met) What is your conclusion about the number of car accidents on snowy days?     
\longanswer[6em]\answer{As t = `r sprintf("%.2f", (alien_mean - 10)/(alien_sd/sqrt(nrow(alien))))`, I reject $H_0$ and conclude that there is very strong evidence that the long-run average number of reported UFO sightings is greater than 10. }
\clearpage
11. Which type of error is described? 
    - Concluding that the number of UFO sightings reported to the police is higher than normal when in fact it is not. \vspace{.5em}         
```{r results='asis'}
cat(ifelse(params$key, "\\phantom{xx}\\hfill\\cfbox{red}{Type 1 error}\\hfill Type 2 error\\hfill\\phantom{xx}", "\\phantom{xx}\\hfill Type 1 error \\hfill Type 2 error \\hfill\\phantom{xx}\\vspace{-1em}"))
```
    - Concluding that we do not have enough evidence to reject $H_0$, when in fact the number of accidents is higher than normal. \vspace{.5em}         
```{r results='asis'}
cat(ifelse(params$key, "\\phantom{xx}\\hfill Type 1 error\\hfill \\cfbox{red}{Type 2 error}\\hfill\\phantom{xx}", "\\phantom{xx}\\hfill Type 1 error \\hfill Type 2 error \\hfill\\phantom{xx}\\vspace{-1em}"))
```
